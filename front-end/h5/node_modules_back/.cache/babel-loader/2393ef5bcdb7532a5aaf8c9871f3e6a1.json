{"remainingRequest":"d:\\project\\luban\\luban-h5\\front-end\\h5\\node_modules\\babel-loader\\lib\\index.js!d:\\project\\luban\\luban-h5\\front-end\\h5\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js??ref--13-0!d:\\project\\luban\\luban-h5\\front-end\\h5\\src\\utils\\http.js","dependencies":[{"path":"d:\\project\\luban\\luban-h5\\front-end\\h5\\src\\utils\\http.js","mtime":1575526862432},{"path":"d:\\project\\luban\\luban-h5\\front-end\\h5\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1575454486584},{"path":"d:\\project\\luban\\luban-h5\\front-end\\h5\\node_modules\\babel-loader\\lib\\index.js","mtime":1575361257763},{"path":"d:\\project\\luban\\luban-h5\\front-end\\h5\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js","mtime":1575454465101}],"contextDependencies":[],"result":["import \"core-js/modules/es6.regexp.split\";\nimport \"core-js/modules/es6.function.name\";\nimport _classCallCheck from \"d:\\\\project\\\\luban\\\\luban-h5\\\\front-end\\\\h5\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/classCallCheck\";\nimport _createClass from \"d:\\\\project\\\\luban\\\\luban-h5\\\\front-end\\\\h5\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/createClass\";\nimport axios from 'axios';\nimport { message } from 'ant-design-vue';\nmessage.config({\n  maxCount: 3\n});\nexport var myMessage = message;\nexport var AxiosWrapper =\n/*#__PURE__*/\nfunction () {\n  // eslint-disable-next-line camelcase\n  function AxiosWrapper(_ref) {\n    var _ref$name = _ref.name,\n        name = _ref$name === void 0 ? 'default' : _ref$name,\n        loading_name = _ref.loading_name,\n        _ref$responseType = _ref.responseType,\n        responseType = _ref$responseType === void 0 ? 'json' : _ref$responseType,\n        headers = _ref.headers,\n        dispatch = _ref.dispatch,\n        commit = _ref.commit,\n        router = _ref.router,\n        successMsg = _ref.successMsg,\n        failMsg = _ref.failMsg,\n        successCallback = _ref.successCallback,\n        failCallback = _ref.failCallback,\n        customRequest = _ref.customRequest;\n\n    _classCallCheck(this, AxiosWrapper);\n\n    this.name = name; // eslint-disable-next-line camelcase\n\n    this.loading_name = loading_name; // eslint-disable-next-line camelcase\n\n    this.responseType = responseType;\n    this.dispatch = dispatch;\n    this.commit = commit;\n    this.router = router;\n    this.successMsg = successMsg;\n    this.failMsg = failMsg;\n    this.customRequest = customRequest;\n    this.successCallback = successCallback;\n    this.failCallback = failCallback;\n    this.source = axios.CancelToken.source();\n    this.instance = axios.create({\n      // baseURL: '/v1',\n      responseType: responseType,\n      headers: headers,\n      cancelToken: this.source.token\n    });\n    this.instance.interceptors.response.use(function (response) {\n      // Do something with response data\n      return Promise.resolve(response);\n    }, function (error) {\n      // Do something with response error\n      return Promise.reject(error);\n    });\n  }\n\n  _createClass(AxiosWrapper, [{\n    key: \"get\",\n    value: function get() {\n      var _this = this,\n          _this$instance;\n\n      for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n        args[_key] = arguments[_key];\n      }\n\n      this.setDefaultLoadingName(args);\n      this.setLoadingValue(true);\n\n      if (this.customRequest) {\n        return this.customRequest.apply(this, args).then(function (data) {\n          var handler = _this.getCommonResponseHandler({\n            failMsg: 'Save Failed.'\n          });\n\n          handler.call(_this, {\n            status: 200,\n            data: data\n          });\n        }).finally(function () {\n          return _this.setLoadingValue(false);\n        });\n      }\n\n      return (_this$instance = this.instance).get.apply(_this$instance, args).then(function (response) {\n        var handler = _this.getCommonResponseHandler({\n          failMsg: 'Query Failed.'\n        });\n\n        handler.call(_this, response);\n      }).catch(function (error) {\n        // handle error\n        myMessage.error(error.message);\n      }).finally(function () {\n        return _this.setLoadingValue(false);\n      });\n    }\n  }, {\n    key: \"post\",\n    value: function post() {\n      var _this$instance2,\n          _this2 = this;\n\n      for (var _len2 = arguments.length, args = new Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {\n        args[_key2] = arguments[_key2];\n      }\n\n      this.setDefaultLoadingName(args);\n      this.setLoadingValue(true);\n      return (_this$instance2 = this.instance).post.apply(_this$instance2, args).then(function (response) {\n        var handler = _this2.getCommonResponseHandler({\n          failMsg: 'Save Failed.'\n        });\n\n        handler.call(_this2, response);\n        return response.data;\n      }).catch(function (error) {\n        // handle error\n        myMessage.error(error.message);\n      }).finally(function () {\n        return _this2.setLoadingValue(false);\n      });\n    }\n  }, {\n    key: \"put\",\n    value: function put() {\n      var _this3 = this,\n          _this$instance3;\n\n      for (var _len3 = arguments.length, args = new Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n        args[_key3] = arguments[_key3];\n      }\n\n      this.setDefaultLoadingName(args);\n      this.setLoadingValue(true);\n\n      if (this.customRequest) {\n        return this.customRequest.apply(this, args).then(function (data) {\n          var handler = _this3.getCommonResponseHandler({\n            failMsg: 'Save Failed.'\n          });\n\n          handler.call(_this3, {\n            status: 200,\n            data: {\n              data: data\n            }\n          });\n        }).finally(function () {\n          return _this3.setLoadingValue(false);\n        });\n      }\n\n      return (_this$instance3 = this.instance).put.apply(_this$instance3, args).then(function (response) {\n        var handler = _this3.getCommonResponseHandler({\n          failMsg: 'Save Failed.'\n        }); // handler.call(this, response)\n\n\n        handler();\n      }).catch(function (error) {\n        // handle error\n        myMessage.error(error.message);\n      }).finally(function () {\n        return _this3.setLoadingValue(false);\n      });\n    }\n  }, {\n    key: \"delete\",\n    value: function _delete() {\n      var _this$instance4,\n          _this4 = this;\n\n      for (var _len4 = arguments.length, args = new Array(_len4), _key4 = 0; _key4 < _len4; _key4++) {\n        args[_key4] = arguments[_key4];\n      }\n\n      this.setDefaultLoadingName(args);\n      this.setLoadingValue(true);\n      return (_this$instance4 = this.instance).delete.apply(_this$instance4, args).then(function (response) {\n        var handler = _this4.getCommonResponseHandler({\n          failMsg: 'Save Failed.'\n        });\n\n        handler.call(_this4, response);\n      }).catch(function (error) {\n        // handle error\n        myMessage.error(error.message);\n      }).finally(function () {\n        return _this4.setLoadingValue(false);\n      });\n    }\n  }, {\n    key: \"cancel\",\n    value: function cancel(reason) {\n      this.source.cancel(reason);\n    }\n  }, {\n    key: \"setLoadingValue\",\n    value: function setLoadingValue(payload) {\n      // this.dispatch('loading/update', { type: this.loading_name, payload }, { root: true })\n      this.commit('loading/update', {\n        type: this.loading_name,\n        payload: payload\n      }, {\n        root: true\n      });\n    }\n  }, {\n    key: \"setDefaultLoadingName\",\n    value: function setDefaultLoadingName() {\n      if (!this.loading_name) {\n        var url = arguments.length <= 0 ? undefined : arguments[0];\n\n        if (url.indexOf('/') !== -1) {\n          var us = url.split('/');\n          url = us[us.length - 1];\n        }\n\n        if (url.indexOf('?') !== -1) {\n          var _us = url.split('?');\n\n          url = _us[0];\n        }\n\n        this.loading_name = \"\".concat(url, \"_loading\");\n      }\n    }\n  }, {\n    key: \"getCommonResponseHandler\",\n    value: function getCommonResponseHandler() {\n      var _this5 = this;\n\n      var _ref2 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},\n          failMsg = _ref2.failMsg;\n\n      return function (response) {\n        if (!response.data) {\n          myMessage.warn(_this5.failMsg || failMsg);\n        } else if (response.status === 200) {\n          _this5.successMsg && myMessage.success(_this5.successMsg);\n\n          if (_this5.successCallback) {\n            _this5.successCallback(response);\n          } else {\n            _this5.commit({\n              type: _this5.name,\n              value: response.data\n            }, {\n              root: true\n            });\n          }\n        } else if (_this5.responseType === 'json') {\n          myMessage.error(response.data.msg);\n\n          if (response.status === 401) {\n            if (_this5.router) {\n              _this5.router.push('/login');\n            }\n          } else {\n            alert(response.data.msg);\n\n            if (_this5.failCallback) {\n              _this5.failCallback(response);\n            }\n          }\n        } else {\n          if (_this5.successCallback) {\n            _this5.successCallback(response);\n          }\n        }\n      };\n    }\n  }]);\n\n  return AxiosWrapper;\n}();",{"version":3,"sources":["d:/project/luban/luban-h5/front-end/h5/src/utils/http.js"],"names":["axios","message","config","maxCount","myMessage","AxiosWrapper","name","loading_name","responseType","headers","dispatch","commit","router","successMsg","failMsg","successCallback","failCallback","customRequest","source","CancelToken","instance","create","cancelToken","token","interceptors","response","use","Promise","resolve","error","reject","args","setDefaultLoadingName","setLoadingValue","then","data","handler","getCommonResponseHandler","call","status","finally","get","catch","post","put","delete","reason","cancel","payload","type","root","url","indexOf","us","split","length","warn","success","value","msg","push","alert"],"mappings":"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","sourcesContent":["import axios from 'axios'\r\nimport { message } from 'ant-design-vue'\r\n\r\nmessage.config({\r\n  maxCount: 3\r\n})\r\n\r\nexport const myMessage = message\r\n\r\nexport class AxiosWrapper {\r\n  // eslint-disable-next-line camelcase\r\n  constructor ({ name = 'default', loading_name, responseType = 'json', headers, dispatch, commit, router, successMsg, failMsg, successCallback, failCallback, customRequest }) {\r\n    this.name = name\r\n    // eslint-disable-next-line camelcase\r\n    this.loading_name = loading_name\r\n    // eslint-disable-next-line camelcase\r\n    this.responseType = responseType\r\n    this.dispatch = dispatch\r\n    this.commit = commit\r\n    this.router = router\r\n    this.successMsg = successMsg\r\n    this.failMsg = failMsg\r\n    this.customRequest = customRequest\r\n    this.successCallback = successCallback\r\n    this.failCallback = failCallback\r\n    this.source = axios.CancelToken.source()\r\n    this.instance = axios.create({\r\n      // baseURL: '/v1',\r\n      responseType,\r\n      headers,\r\n      cancelToken: this.source.token\r\n    })\r\n    this.instance.interceptors.response.use(response => {\r\n      // Do something with response data\r\n      return Promise.resolve(response)\r\n    }, error => {\r\n      // Do something with response error\r\n      return Promise.reject(error)\r\n    })\r\n  }\r\n\r\n  get (...args) {\r\n    this.setDefaultLoadingName(args)\r\n\r\n    this.setLoadingValue(true)\r\n    if (this.customRequest) {\r\n      return this.customRequest(...args)\r\n        .then(data => {\r\n          const handler = this.getCommonResponseHandler({ failMsg: 'Save Failed.' })\r\n          handler.call(this, { status: 200, data })\r\n        })\r\n        .finally(() => this.setLoadingValue(false))\r\n    }\r\n    return this.instance.get(...args).then(response => {\r\n      const handler = this.getCommonResponseHandler({ failMsg: 'Query Failed.' })\r\n      handler.call(this, response)\r\n    }).catch(error => {\r\n      // handle error\r\n      myMessage.error(error.message)\r\n    }).finally(() => this.setLoadingValue(false))\r\n  }\r\n\r\n  post (...args) {\r\n    this.setDefaultLoadingName(args)\r\n\r\n    this.setLoadingValue(true)\r\n    return this.instance.post(...args).then(response => {\r\n      const handler = this.getCommonResponseHandler({ failMsg: 'Save Failed.' })\r\n      handler.call(this, response)\r\n      return response.data\r\n    }).catch(error => {\r\n      // handle error\r\n      myMessage.error(error.message)\r\n    }).finally(() => this.setLoadingValue(false))\r\n  }\r\n\r\n  put (...args) {\r\n    this.setDefaultLoadingName(args)\r\n\r\n    this.setLoadingValue(true)\r\n    if (this.customRequest) {\r\n      return this.customRequest(...args)\r\n        .then(data => {\r\n          const handler = this.getCommonResponseHandler({ failMsg: 'Save Failed.' })\r\n          handler.call(this, { status: 200, data: { data } })\r\n        })\r\n        .finally(() => this.setLoadingValue(false))\r\n    }\r\n    return this.instance.put(...args).then(response => {\r\n      const handler = this.getCommonResponseHandler({ failMsg: 'Save Failed.' })\r\n      // handler.call(this, response)\r\n      handler()\r\n    }).catch(error => {\r\n      // handle error\r\n      myMessage.error(error.message)\r\n    }).finally(() => this.setLoadingValue(false))\r\n  }\r\n\r\n  delete (...args) {\r\n    this.setDefaultLoadingName(args)\r\n\r\n    this.setLoadingValue(true)\r\n    return this.instance.delete(...args).then(response => {\r\n      const handler = this.getCommonResponseHandler({ failMsg: 'Save Failed.' })\r\n      handler.call(this, response)\r\n    }).catch(error => {\r\n      // handle error\r\n      myMessage.error(error.message)\r\n    }).finally(() => this.setLoadingValue(false))\r\n  }\r\n\r\n  cancel (reason) {\r\n    this.source.cancel(reason)\r\n  }\r\n\r\n  setLoadingValue (payload) {\r\n    // this.dispatch('loading/update', { type: this.loading_name, payload }, { root: true })\r\n    this.commit('loading/update', { type: this.loading_name, payload }, { root: true })\r\n  }\r\n\r\n  setDefaultLoadingName (...args) {\r\n    if (!this.loading_name) {\r\n      let url = args[0]\r\n      if (url.indexOf('/') !== -1) {\r\n        let us = url.split('/')\r\n        url = us[us.length - 1]\r\n      }\r\n      if (url.indexOf('?') !== -1) {\r\n        let us = url.split('?')\r\n        url = us[0]\r\n      }\r\n      this.loading_name = `${url}_loading`\r\n    }\r\n  }\r\n\r\n  getCommonResponseHandler ({ failMsg } = {}) {\r\n    return (response) => {\r\n      if (!response.data) {\r\n        myMessage.warn(this.failMsg || failMsg)\r\n      } else if (response.status === 200) {\r\n        this.successMsg && myMessage.success(this.successMsg)\r\n        if (this.successCallback) {\r\n          this.successCallback(response)\r\n        } else {\r\n          this.commit({ type: this.name, value: response.data }, { root: true })\r\n        }\r\n      } else if (this.responseType === 'json') {\r\n        myMessage.error(response.data.msg)\r\n        if (response.status === 401) {\r\n          if (this.router) {\r\n            this.router.push('/login')\r\n          }\r\n        } else {\r\n          alert(response.data.msg)\r\n          if (this.failCallback) {\r\n            this.failCallback(response)\r\n          }\r\n        }\r\n      } else {\r\n        if (this.successCallback) {\r\n          this.successCallback(response)\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n"]}]}