{"remainingRequest":"d:\\project\\luban\\luban-h5\\front-end\\h5\\node_modules\\babel-loader\\lib\\index.js!d:\\project\\luban\\luban-h5\\front-end\\h5\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js??ref--13-0!d:\\project\\luban\\luban-h5\\front-end\\h5\\src\\store\\plugins\\undo-redo\\index.js","dependencies":[{"path":"d:\\project\\luban\\luban-h5\\front-end\\h5\\src\\store\\plugins\\undo-redo\\index.js","mtime":1575526862422},{"path":"d:\\project\\luban\\luban-h5\\front-end\\h5\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1575454486584},{"path":"d:\\project\\luban\\luban-h5\\front-end\\h5\\node_modules\\babel-loader\\lib\\index.js","mtime":1575361257763},{"path":"d:\\project\\luban\\luban-h5\\front-end\\h5\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js","mtime":1575454465101}],"contextDependencies":[],"result":["import \"core-js/modules/es7.array.includes\";\nimport { cloneDeep } from 'lodash';\nimport undoRedoHistory from \"./History\";\n/**\r\n * #!zh: setElementCommonStyle 因为是在 mousemove 时候触发的，执行过于频繁，没有必要计入history，因此需要过滤。\r\n * 主要记录：拖动完成时候(mouseup)时候的位置、删除元素之前的状态等\r\n */\n// const unRecordHistoryMutationTypes = ['editor/setElementCommonStyle']\n\nvar recordHistoryMutationTypes = ['editor/recordRect', 'editor/elementManager'];\n\nvar undoRedoPlugin = function undoRedoPlugin(store) {\n  // initialize and save the starting stage\n  undoRedoHistory.init(store);\n  var firstState = cloneDeep(store.state);\n  undoRedoHistory.addState(firstState);\n  store.subscribe(function (mutation, state) {\n    var type = mutation.type;\n    if (!recordHistoryMutationTypes.includes(type)) return; // is called AFTER every mutation\n\n    undoRedoHistory.addState(cloneDeep(state));\n  });\n};\n\nexport default undoRedoPlugin;",{"version":3,"sources":["d:/project/luban/luban-h5/front-end/h5/src/store/plugins/undo-redo/index.js"],"names":["cloneDeep","undoRedoHistory","recordHistoryMutationTypes","undoRedoPlugin","store","init","firstState","state","addState","subscribe","mutation","type","includes"],"mappings":";AACA,SAASA,SAAT,QAA0B,QAA1B;AACA,OAAOC,eAAP;AACA;;;;AAIA;;AACA,IAAMC,0BAA0B,GAAG,CACjC,mBADiC,EAEjC,uBAFiC,CAAnC;;AAKA,IAAMC,cAAc,GAAG,SAAjBA,cAAiB,CAACC,KAAD,EAAW;AAChC;AACAH,EAAAA,eAAe,CAACI,IAAhB,CAAqBD,KAArB;AACA,MAAIE,UAAU,GAAGN,SAAS,CAACI,KAAK,CAACG,KAAP,CAA1B;AACAN,EAAAA,eAAe,CAACO,QAAhB,CAAyBF,UAAzB;AAEAF,EAAAA,KAAK,CAACK,SAAN,CAAgB,UAACC,QAAD,EAAWH,KAAX,EAAqB;AAAA,QAC3BI,IAD2B,GAClBD,QADkB,CAC3BC,IAD2B;AAEnC,QAAI,CAACT,0BAA0B,CAACU,QAA3B,CAAoCD,IAApC,CAAL,EAAgD,OAFb,CAGnC;;AACAV,IAAAA,eAAe,CAACO,QAAhB,CAAyBR,SAAS,CAACO,KAAD,CAAlC;AACD,GALD;AAMD,CAZD;;AAcA,eAAeJ,cAAf","sourcesContent":["\r\nimport { cloneDeep } from 'lodash'\r\nimport undoRedoHistory from './History'\r\n/**\r\n * #!zh: setElementCommonStyle 因为是在 mousemove 时候触发的，执行过于频繁，没有必要计入history，因此需要过滤。\r\n * 主要记录：拖动完成时候(mouseup)时候的位置、删除元素之前的状态等\r\n */\r\n// const unRecordHistoryMutationTypes = ['editor/setElementCommonStyle']\r\nconst recordHistoryMutationTypes = [\r\n  'editor/recordRect',\r\n  'editor/elementManager'\r\n]\r\n\r\nconst undoRedoPlugin = (store) => {\r\n  // initialize and save the starting stage\r\n  undoRedoHistory.init(store)\r\n  let firstState = cloneDeep(store.state)\r\n  undoRedoHistory.addState(firstState)\r\n\r\n  store.subscribe((mutation, state) => {\r\n    const { type } = mutation\r\n    if (!recordHistoryMutationTypes.includes(type)) return\r\n    // is called AFTER every mutation\r\n    undoRedoHistory.addState(cloneDeep(state))\r\n  })\r\n}\r\n\r\nexport default undoRedoPlugin\r\n"]}]}