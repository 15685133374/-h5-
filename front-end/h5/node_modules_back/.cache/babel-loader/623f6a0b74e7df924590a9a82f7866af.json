{"remainingRequest":"d:\\project\\luban\\luban-h5\\front-end\\h5\\node_modules\\babel-loader\\lib\\index.js!d:\\project\\luban\\luban-h5\\front-end\\h5\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js??ref--13-0!d:\\project\\luban\\luban-h5\\front-end\\h5\\src\\components\\core\\editor\\edit-panel\\props.js","dependencies":[{"path":"d:\\project\\luban\\luban-h5\\front-end\\h5\\src\\components\\core\\editor\\edit-panel\\props.js","mtime":1575526862172},{"path":"d:\\project\\luban\\luban-h5\\front-end\\h5\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1575454486584},{"path":"d:\\project\\luban\\luban-h5\\front-end\\h5\\node_modules\\babel-loader\\lib\\index.js","mtime":1575361257763},{"path":"d:\\project\\luban\\luban-h5\\front-end\\h5\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js","mtime":1575454465101}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/es6.object.keys\";\nimport _mergeJSXProps from \"@vue/babel-helper-vue-jsx-merge-props\";\nimport _slicedToArray from \"d:\\\\project\\\\luban\\\\luban-h5\\\\front-end\\\\h5\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/slicedToArray\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es7.object.entries\";\nimport \"core-js/modules/es6.function.name\";\nimport _defineProperty from \"d:\\\\project\\\\luban\\\\luban-h5\\\\front-end\\\\h5\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport Vue from 'vue';\nimport { mapState, mapActions } from 'vuex';\nimport { getVM } from \"../../../../utils/element\";\nexport default {\n  data: function data() {\n    return {\n      loadCustomEditorFlag: false\n    };\n  },\n  props: {\n    layout: {\n      type: String,\n      default: 'horizontal'\n    }\n  },\n  computed: _objectSpread({}, mapState('editor', ['editingElement', 'editingElementEditorConfig']), {\n    customEditorName: function customEditorName() {\n      return \"\".concat(this.editingElement.name, \"-custom-editor\");\n    }\n  }),\n  methods: _objectSpread({}, mapActions('editor', ['setEditingElement']), {\n    loadCustomEditorForPlugin: function loadCustomEditorForPlugin() {\n      var _this = this;\n\n      this.loadCustomEditorFlag = false;\n      if (!this.editingElement) return;\n\n      if (Vue.component(this.customEditorName)) {\n        this.loadCustomEditorFlag = true;\n      } else {\n        import(\"../../../plugins/\".concat(this.editingElement.name, \"__editor\")).then(function (component) {\n          _this.loadCustomEditorFlag = true;\n          Vue.component(_this.customEditorName, component.default);\n        }).catch(function (err) {\n          console.log(err);\n          console.warn('没有发现组件对应的编辑器');\n        });\n      }\n    },\n\n    /**\r\n     * 将插件属性的 自定义增强编辑器注入 属性编辑面板中\r\n     */\n    mixinEnhancedPropsEditor: function mixinEnhancedPropsEditor(editingElement) {\n      if (!this.editingElementEditorConfig || !this.editingElementEditorConfig.components) return;\n      var components = this.editingElementEditorConfig.components;\n\n      for (var key in components) {\n        if (this.$options.components[key]) return;\n        this.$options.components[key] = components[key];\n      }\n    },\n    renderPropsEditorPanel: function renderPropsEditorPanel(h, editingElement) {\n      var _this2 = this;\n\n      var vm = getVM(editingElement.name);\n      var props = vm.$options.props;\n      return h(\"a-form\", {\n        \"ref\": \"form\",\n        \"attrs\": {\n          \"size\": \"mini\",\n          \"id\": \"props-edit-form\",\n          \"layout\": this.layout\n        }\n      }, [// plugin-custom-editor\n      this.loadCustomEditorFlag && h(this.customEditorName, {\n        props: {\n          elementProps: editingElement.pluginProps\n        }\n      }), Object.entries(props).filter(function (_ref) {\n        var _ref2 = _slicedToArray(_ref, 2),\n            propKey = _ref2[0],\n            obj = _ref2[1];\n\n        return obj.editor && !obj.editor.custom;\n      }).map(function (_ref3) {\n        var _ref4 = _slicedToArray(_ref3, 2),\n            propKey = _ref4[0],\n            obj = _ref4[1];\n\n        var item = obj.editor; // https://vuejs.org/v2/guide/render-function.html\n\n        var data = {\n          style: {\n            width: '100%'\n          },\n          props: _objectSpread({}, item.prop || {}, {\n            // https://vuejs.org/v2/guide/render-function.html#v-model\n            // #!zh:不设置默认值的原因（下一行的代码，注释的代码）：\n            // 比如表单 input，如果用户手动删除了 placeholder的内容，程序会用defaultPropValue填充，\n            // 表现在UI上就是：用户永远无法彻底删掉默认值（必须保留至少一个字符）\n            // value: editingElement.pluginProps[propKey] || item.defaultPropValue\n            value: editingElement.pluginProps[propKey]\n          }),\n          on: {\n            // https://vuejs.org/v2/guide/render-function.html#v-model\n            // input (e) {\n            //   editingElement.pluginProps[propKey] = e.target ? e.target.value : e\n            // }\n            change: function change(e) {\n              // TODO fixme: update plugin props in vuex with dispatch\n              editingElement.pluginProps[propKey] = e.target ? e.target.value : e;\n            }\n          }\n        };\n        var formItemLayout = _this2.layout === 'horizontal' ? {\n          labelCol: {\n            span: 6\n          },\n          wrapperCol: {\n            span: 16,\n            offset: 2\n          }\n        } : {};\n        var formItemData = {\n          props: _objectSpread({}, formItemLayout, {\n            label: item.label\n          })\n        };\n        return h(\"a-form-item\", _mergeJSXProps([{}, formItemData]), [item.extra && h(\"div\", {\n          \"slot\": \"extra\"\n        }, [typeof item.extra === 'function' ? item.extra(h) : item.extra]), h(item.type, data)]);\n      })]);\n    }\n  }),\n  render: function render(h) {\n    var ele = this.editingElement;\n    if (!ele) return h(\"span\", [this.$t('editor.editPanel.common.empty')]);\n    this.mixinEnhancedPropsEditor(ele);\n    return this.renderPropsEditorPanel(h, ele);\n  },\n  created: function created() {\n    window.getEditorApp.$on('setEditingElement', this.loadCustomEditorForPlugin);\n  }\n};",{"version":3,"sources":["d:/project/luban/luban-h5/front-end/h5/src/components/core/editor/edit-panel/props.js"],"names":["Vue","mapState","mapActions","getVM","data","loadCustomEditorFlag","props","layout","type","String","default","computed","customEditorName","editingElement","name","methods","loadCustomEditorForPlugin","component","then","catch","err","console","log","warn","mixinEnhancedPropsEditor","editingElementEditorConfig","components","key","$options","renderPropsEditorPanel","h","vm","elementProps","pluginProps","Object","entries","filter","propKey","obj","editor","custom","map","item","style","width","prop","value","on","change","e","target","formItemLayout","labelCol","span","wrapperCol","offset","formItemData","label","extra","render","ele","$t","created","window","getEditorApp","$on"],"mappings":"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","sourcesContent":["import Vue from 'vue'\r\nimport { mapState, mapActions } from 'vuex'\r\nimport { getVM } from '../../../../utils/element'\r\n\r\nexport default {\r\n  data: () => ({\r\n    loadCustomEditorFlag: false\r\n  }),\r\n  props: {\r\n    layout: {\r\n      type: String,\r\n      default: 'horizontal'\r\n    }\r\n  },\r\n  computed: {\r\n    ...mapState('editor', ['editingElement', 'editingElementEditorConfig']),\r\n    customEditorName () {\r\n      return `${this.editingElement.name}-custom-editor`\r\n    }\r\n  },\r\n  methods: {\r\n    ...mapActions('editor', [\r\n      'setEditingElement'\r\n    ]),\r\n    loadCustomEditorForPlugin () {\r\n      this.loadCustomEditorFlag = false\r\n      if (!this.editingElement) return\r\n\r\n      if (Vue.component(this.customEditorName)) {\r\n        this.loadCustomEditorFlag = true\r\n      } else {\r\n        import(`../../../plugins/${this.editingElement.name}__editor`).then(component => {\r\n          this.loadCustomEditorFlag = true\r\n          Vue.component(this.customEditorName, component.default)\r\n        }).catch(err => {\r\n          console.log(err)\r\n          console.warn('没有发现组件对应的编辑器')\r\n        })\r\n      }\r\n    },\r\n    /**\r\n     * 将插件属性的 自定义增强编辑器注入 属性编辑面板中\r\n     */\r\n    mixinEnhancedPropsEditor (editingElement) {\r\n      if (!this.editingElementEditorConfig || !this.editingElementEditorConfig.components) return\r\n      const { components } = this.editingElementEditorConfig\r\n      for (const key in components) {\r\n        if (this.$options.components[key]) return\r\n        this.$options.components[key] = components[key]\r\n      }\r\n    },\r\n    renderPropsEditorPanel (h, editingElement) {\r\n      const vm = getVM(editingElement.name)\r\n      const props = vm.$options.props\r\n\r\n      return (\r\n        <a-form\r\n          ref=\"form\"\r\n          size=\"mini\"\r\n          id=\"props-edit-form\"\r\n          layout={this.layout}\r\n        >\r\n          {\r\n            // plugin-custom-editor\r\n            this.loadCustomEditorFlag &&\r\n            h(this.customEditorName, {\r\n              props: {\r\n                elementProps: editingElement.pluginProps\r\n              }\r\n            })\r\n          }\r\n          {\r\n            Object\r\n              .entries(props)\r\n              .filter(([propKey, obj]) => obj.editor && !obj.editor.custom)\r\n              .map(([propKey, obj]) => {\r\n                const item = obj.editor\r\n                // https://vuejs.org/v2/guide/render-function.html\r\n                const data = {\r\n                  style: { width: '100%' },\r\n                  props: {\r\n                    ...item.prop || {},\r\n                    // https://vuejs.org/v2/guide/render-function.html#v-model\r\n\r\n                    // #!zh:不设置默认值的原因（下一行的代码，注释的代码）：\r\n                    // 比如表单 input，如果用户手动删除了 placeholder的内容，程序会用defaultPropValue填充，\r\n                    // 表现在UI上就是：用户永远无法彻底删掉默认值（必须保留至少一个字符）\r\n                    // value: editingElement.pluginProps[propKey] || item.defaultPropValue\r\n                    value: editingElement.pluginProps[propKey]\r\n                  },\r\n                  on: {\r\n                  // https://vuejs.org/v2/guide/render-function.html#v-model\r\n                  // input (e) {\r\n                  //   editingElement.pluginProps[propKey] = e.target ? e.target.value : e\r\n                  // }\r\n                    change (e) {\r\n                    // TODO fixme: update plugin props in vuex with dispatch\r\n                      editingElement.pluginProps[propKey] = e.target ? e.target.value : e\r\n                    }\r\n                  }\r\n                }\r\n                const formItemLayout = this.layout === 'horizontal' ? {\r\n                  labelCol: { span: 6 }, wrapperCol: { span: 16, offset: 2 }\r\n                } : {}\r\n                const formItemData = {\r\n                  props: {\r\n                    ...formItemLayout,\r\n                    label: item.label\r\n                  }\r\n                }\r\n                return (\r\n                  <a-form-item {...formItemData}>\r\n                    { item.extra && <div slot=\"extra\">{typeof item.extra === 'function' ? item.extra(h) : item.extra}</div>}\r\n                    { h(item.type, data) }\r\n                  </a-form-item>\r\n                )\r\n              })\r\n          }\r\n        </a-form>\r\n      )\r\n    }\r\n  },\r\n  render (h) {\r\n    const ele = this.editingElement\r\n    if (!ele) return (<span>{this.$t('editor.editPanel.common.empty')}</span>)\r\n    this.mixinEnhancedPropsEditor(ele)\r\n    return this.renderPropsEditorPanel(h, ele)\r\n  },\r\n  created () {\r\n    window.getEditorApp.$on('setEditingElement', this.loadCustomEditorForPlugin)\r\n  }\r\n}\r\n"]}]}