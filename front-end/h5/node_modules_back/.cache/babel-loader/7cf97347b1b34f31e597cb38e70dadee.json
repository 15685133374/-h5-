{"remainingRequest":"d:\\project\\luban\\luban-h5\\front-end\\h5\\node_modules\\babel-loader\\lib\\index.js!d:\\project\\luban\\luban-h5\\front-end\\h5\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js??ref--13-0!d:\\project\\luban\\luban-h5\\front-end\\h5\\src\\components\\core\\support\\shape.js","dependencies":[{"path":"d:\\project\\luban\\luban-h5\\front-end\\h5\\src\\components\\core\\support\\shape.js","mtime":1575940953801},{"path":"d:\\project\\luban\\luban-h5\\front-end\\h5\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1575454486584},{"path":"d:\\project\\luban\\luban-h5\\front-end\\h5\\node_modules\\babel-loader\\lib\\index.js","mtime":1575361257763},{"path":"d:\\project\\luban\\luban-h5\\front-end\\h5\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js","mtime":1575454465101}],"contextDependencies":[],"result":["import \"core-js/modules/es7.object.get-own-property-descriptors\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.object.keys\";\nimport \"core-js/modules/es6.regexp.split\";\nimport _defineProperty from \"d:\\\\project\\\\luban\\\\luban-h5\\\\front-end\\\\h5\\\\node_modules\\\\@babel\\\\runtime-corejs2/helpers/esm/defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(source, true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(source).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport animationMixin from '@/mixins/animation.js';\n/**\r\n * #!zh: 上下左右 对应的 东南西北\r\n * #!en: top(north)、bottom(south)、left(west)、right(east)\r\n */\n\nvar directionKey = {\n  t: 'n',\n  b: 's',\n  l: 'w',\n  r: 'e'\n}; // #!zh: 四个边角、两条中线上的点\n\nvar points = ['lt', 'rt', 'lb', 'rb', 'l', 'r', 't', 'b'];\nexport default {\n  mixins: [animationMixin],\n  props: ['defaultPosition', 'active', 'handleMousedownProp', 'handleElementMoveProp', 'handlePointMoveProp', 'handleElementMouseUpProp', 'handlePointMouseUpProp', 'element'],\n  computed: {\n    position: function position() {\n      return _objectSpread({}, this.defaultPosition);\n    }\n  },\n  methods: {\n    /**\r\n     * 通过方位计算样式，主要是 top、left、鼠标样式\r\n     */\n    getPointStyle: function getPointStyle(point) {\n      var isWrapElement = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n      var pos = this.position;\n      var top = pos.top; // !#zh 减4是为了让元素能够处于 border 的中间\n\n      var left = pos.left;\n      var height = pos.height;\n      var width = pos.width;\n      var hasT = /t/.test(point);\n      var hasB = /b/.test(point);\n      var hasL = /l/.test(point);\n      var hasR = /r/.test(point);\n      var newLeft = 0;\n      var newTop = 0;\n      var cans = document.getElementsByClassName('edit-mode')[0].clientHeight;\n\n      if (pos.top + pos.height > cans) {\n        document.getElementsByClassName('edit-mode')[0].style.height = pos.top + pos.height + 'px';\n        document.getElementsByClassName('canvas-wrapper')[0].style.height = pos.top + pos.height + 'px';\n      } else if (pos.top + pos.height <= 566) {\n        document.getElementsByClassName('edit-mode')[0].style.height = 566 + 'px';\n      }\n\n      if (point.length === 2) {\n        newLeft = hasL ? 0 : width;\n        newTop = hasT ? 0 : height;\n      } else {\n        // !#zh 上下点，宽度固定在中间\n        if (hasT || hasB) {\n          newLeft = width / 2;\n          newTop = hasT ? 0 : height;\n        } // !#zh 左右点，高度固定在中间\n\n\n        if (hasL || hasR) {\n          newLeft = hasL ? 0 : width;\n          newTop = height / 2;\n        }\n      }\n\n      var style = {\n        marginLeft: hasL || hasR ? '-3px' : 0,\n        marginTop: hasT || hasB ? '-3px' : 0,\n        left: \"\".concat(newLeft + (isWrapElement ? 0 : left), \"px\"),\n        top: \"\".concat(newTop + (isWrapElement ? 0 : top), \"px\"),\n        cursor: point.split('').reverse().map(function (m) {\n          return directionKey[m];\n        }).join('') + '-resize'\n      };\n      return style;\n    },\n\n    /**\r\n     * !#zh 主要目的是：阻止冒泡\r\n     */\n    handleWrapperClick: function handleWrapperClick(e) {// e.stopPropagation()\n      // e.preventDefault()\n    },\n    mousedownForMark: function mousedownForMark(point, downEvent) {\n      var _this = this;\n\n      downEvent.stopPropagation();\n      downEvent.preventDefault(); // Let's stop this event.\n\n      var pos = _objectSpread({}, this.position);\n\n      console.log('pos', pos);\n      var height = pos.height;\n      var width = pos.width;\n      var top = pos.top;\n      var left = pos.left;\n      var startX = downEvent.clientX;\n      var startY = downEvent.clientY;\n\n      var move = function move(moveEvent) {\n        var currX = moveEvent.clientX;\n        var currY = moveEvent.clientY;\n        var disY = currY - startY;\n        var disX = currX - startX;\n        var hasT = /t/.test(point);\n        var hasB = /b/.test(point);\n        var hasL = /l/.test(point);\n        var hasR = /r/.test(point);\n        var newHeight = +height + (hasT ? -disY : hasB ? disY : 0);\n        var newWidth = +width + (hasL ? -disX : hasR ? disX : 0);\n        pos.height = newHeight > 0 ? newHeight : 0;\n        pos.width = newWidth > 0 ? newWidth : 0;\n        pos.left = +left + (hasL ? disX : 0);\n        pos.top = +top + (hasT ? disY : 0);\n\n        _this.handlePointMoveProp(pos);\n      };\n\n      var up = function up() {\n        _this.handlePointMouseUpProp();\n\n        document.removeEventListener('mousemove', move);\n        document.removeEventListener('mouseup', up);\n      };\n\n      document.addEventListener('mousemove', move);\n      document.addEventListener('mouseup', up);\n    },\n\n    /**\r\n     * !#zh 给 当前选中元素 添加鼠标移动相关事件\r\n     *\r\n     * @param {mouseEvent} e\r\n     */\n    mousedownForElement: function mousedownForElement(e) {\n      var _this2 = this;\n\n      var pos = _objectSpread({}, this.position);\n\n      var startY = e.clientY;\n      var startX = e.clientX;\n      var startTop = pos.top;\n      var startLeft = pos.left;\n\n      var move = function move(moveEvent) {\n        // !#zh 移动的时候，不需要向后代元素传递事件，只需要单纯的移动就OK\n        moveEvent.stopPropagation();\n        moveEvent.preventDefault();\n        var currX = moveEvent.clientX;\n        var currY = moveEvent.clientY;\n        pos.top = currY - startY + startTop;\n        pos.left = currX - startX + startLeft;\n\n        _this2.handleElementMoveProp(pos);\n      };\n\n      var up = function up(moveEvent) {\n        _this2.handleElementMouseUpProp();\n\n        document.removeEventListener('mousemove', move, true);\n        document.removeEventListener('mouseup', up, true);\n      };\n\n      document.addEventListener('mousemove', move, true);\n      document.addEventListener('mouseup', up, true); // TODO add comment\n\n      return true;\n    },\n    handleMousedown: function handleMousedown(e) {\n      if (this.handleMousedownProp) {\n        this.handleMousedownProp();\n        this.mousedownForElement(e, this.element);\n      }\n    }\n  },\n  render: function render(h) {\n    var _this3 = this;\n\n    return h(\"div\", {\n      \"on\": {\n        \"click\": this.handleWrapperClick,\n        \"mousedown\": this.handleMousedown\n      },\n      \"class\": {\n        'shape__wrapper-active': this.active\n      }\n    }, [this.active && points.map(function (point) {\n      var pointStyle = _this3.getPointStyle(point);\n\n      return h(\"div\", {\n        \"key\": point,\n        \"attrs\": {\n          \"data-point\": point\n        },\n        \"style\": pointStyle,\n        \"class\": \"shape__scale-point\",\n        \"on\": {\n          \"mousedown\": _this3.mousedownForMark.bind(_this3, point)\n        }\n      });\n    }), this.$slots.default]);\n  }\n};",{"version":3,"sources":["d:/project/luban/luban-h5/front-end/h5/src/components/core/support/shape.js"],"names":["animationMixin","directionKey","t","b","l","r","points","mixins","props","computed","position","defaultPosition","methods","getPointStyle","point","isWrapElement","pos","top","left","height","width","hasT","test","hasB","hasL","hasR","newLeft","newTop","cans","document","getElementsByClassName","clientHeight","style","length","marginLeft","marginTop","cursor","split","reverse","map","m","join","handleWrapperClick","e","mousedownForMark","downEvent","stopPropagation","preventDefault","console","log","startX","clientX","startY","clientY","move","moveEvent","currX","currY","disY","disX","newHeight","newWidth","handlePointMoveProp","up","handlePointMouseUpProp","removeEventListener","addEventListener","mousedownForElement","startTop","startLeft","handleElementMoveProp","handleElementMouseUpProp","handleMousedown","handleMousedownProp","element","render","h","active","pointStyle","bind","$slots","default"],"mappings":";;;;;;;;;;AAAA,OAAOA,cAAP,MAA2B,uBAA3B;AAEA;;;;;AAIA,IAAMC,YAAY,GAAG;AACnBC,EAAAA,CAAC,EAAE,GADgB;AAEnBC,EAAAA,CAAC,EAAE,GAFgB;AAGnBC,EAAAA,CAAC,EAAE,GAHgB;AAInBC,EAAAA,CAAC,EAAE;AAJgB,CAArB,C,CAOA;;AACA,IAAMC,MAAM,GAAG,CAAC,IAAD,EAAO,IAAP,EAAa,IAAb,EAAmB,IAAnB,EAAyB,GAAzB,EAA8B,GAA9B,EAAmC,GAAnC,EAAwC,GAAxC,CAAf;AAEA,eAAe;AACbC,EAAAA,MAAM,EAAE,CAACP,cAAD,CADK;AAEbQ,EAAAA,KAAK,EAAE,CAAC,iBAAD,EAAoB,QAApB,EAA8B,qBAA9B,EAAqD,uBAArD,EAA8E,qBAA9E,EAAqG,0BAArG,EAAiI,wBAAjI,EAA2J,SAA3J,CAFM;AAGbC,EAAAA,QAAQ,EAAE;AACRC,IAAAA,QADQ,sBACI;AACV,+BAAY,KAAKC,eAAjB;AACD;AAHO,GAHG;AAQbC,EAAAA,OAAO,EAAE;AACP;;;AAGAC,IAAAA,aAJO,yBAIQC,KAJR,EAIqC;AAAA,UAAtBC,aAAsB,uEAAN,IAAM;AAE1C,UAAMC,GAAG,GAAG,KAAKN,QAAjB;AACA,UAAMO,GAAG,GAAGD,GAAG,CAACC,GAAhB,CAH0C,CAGtB;;AACpB,UAAMC,IAAI,GAAGF,GAAG,CAACE,IAAjB;AACA,UAAMC,MAAM,GAAGH,GAAG,CAACG,MAAnB;AACA,UAAMC,KAAK,GAAGJ,GAAG,CAACI,KAAlB;AACA,UAAIC,IAAI,GAAG,IAAIC,IAAJ,CAASR,KAAT,CAAX;AACA,UAAIS,IAAI,GAAG,IAAID,IAAJ,CAASR,KAAT,CAAX;AACA,UAAIU,IAAI,GAAG,IAAIF,IAAJ,CAASR,KAAT,CAAX;AACA,UAAIW,IAAI,GAAG,IAAIH,IAAJ,CAASR,KAAT,CAAX;AACA,UAAIY,OAAO,GAAG,CAAd;AACA,UAAIC,MAAM,GAAG,CAAb;AACA,UAAIC,IAAI,GAAGC,QAAQ,CAACC,sBAAT,CAAgC,WAAhC,EAA6C,CAA7C,EAAgDC,YAA3D;;AACA,UAAGf,GAAG,CAACC,GAAJ,GAASD,GAAG,CAACG,MAAb,GAAqBS,IAAxB,EAA6B;AAC3BC,QAAAA,QAAQ,CAACC,sBAAT,CAAgC,WAAhC,EAA6C,CAA7C,EAAgDE,KAAhD,CAAsDb,MAAtD,GAA6DH,GAAG,CAACC,GAAJ,GAAUD,GAAG,CAACG,MAAd,GAAuB,IAApF;AACAU,QAAAA,QAAQ,CAACC,sBAAT,CAAgC,gBAAhC,EAAkD,CAAlD,EAAqDE,KAArD,CAA2Db,MAA3D,GAAoEH,GAAG,CAACC,GAAJ,GAAUD,GAAG,CAACG,MAAd,GAAuB,IAA3F;AACD,OAHD,MAGM,IAAGH,GAAG,CAACC,GAAJ,GAAUD,GAAG,CAACG,MAAd,IAAuB,GAA1B,EAA8B;AAClCU,QAAAA,QAAQ,CAACC,sBAAT,CAAgC,WAAhC,EAA6C,CAA7C,EAAgDE,KAAhD,CAAsDb,MAAtD,GAA+D,MAAK,IAApE;AACD;;AACD,UAAIL,KAAK,CAACmB,MAAN,KAAiB,CAArB,EAAwB;AACtBP,QAAAA,OAAO,GAAGF,IAAI,GAAG,CAAH,GAAOJ,KAArB;AACAO,QAAAA,MAAM,GAAGN,IAAI,GAAG,CAAH,GAAOF,MAApB;AACD,OAHD,MAGO;AACL;AACA,YAAIE,IAAI,IAAIE,IAAZ,EAAkB;AAChBG,UAAAA,OAAO,GAAGN,KAAK,GAAG,CAAlB;AACAO,UAAAA,MAAM,GAAGN,IAAI,GAAG,CAAH,GAAOF,MAApB;AACD,SALI,CAML;;;AACA,YAAIK,IAAI,IAAIC,IAAZ,EAAkB;AAChBC,UAAAA,OAAO,GAAGF,IAAI,GAAG,CAAH,GAAOJ,KAArB;AACAO,UAAAA,MAAM,GAAGR,MAAM,GAAG,CAAlB;AACD;AACF;;AACD,UAAMa,KAAK,GAAG;AACZE,QAAAA,UAAU,EAAGV,IAAI,IAAIC,IAAT,GAAiB,MAAjB,GAA0B,CAD1B;AAEZU,QAAAA,SAAS,EAAGd,IAAI,IAAIE,IAAT,GAAiB,MAAjB,GAA0B,CAFzB;AAGZL,QAAAA,IAAI,YAAKQ,OAAO,IAAIX,aAAa,GAAG,CAAH,GAAOG,IAAxB,CAAZ,OAHQ;AAIZD,QAAAA,GAAG,YAAKU,MAAM,IAAIZ,aAAa,GAAG,CAAH,GAAOE,GAAxB,CAAX,OAJS;AAKZmB,QAAAA,MAAM,EAAEtB,KAAK,CAACuB,KAAN,CAAY,EAAZ,EAAgBC,OAAhB,GAA0BC,GAA1B,CAA8B,UAAAC,CAAC;AAAA,iBAAIvC,YAAY,CAACuC,CAAD,CAAhB;AAAA,SAA/B,EAAoDC,IAApD,CAAyD,EAAzD,IAA+D;AAL3D,OAAd;AAOA,aAAOT,KAAP;AACD,KA/CM;;AAgDP;;;AAGAU,IAAAA,kBAnDO,8BAmDaC,CAnDb,EAmDgB,CACrB;AACA;AACD,KAtDM;AAuDPC,IAAAA,gBAvDO,4BAuDW9B,KAvDX,EAuDkB+B,SAvDlB,EAuD6B;AAAA;;AAClCA,MAAAA,SAAS,CAACC,eAAV;AACAD,MAAAA,SAAS,CAACE,cAAV,GAFkC,CAEP;;AAC3B,UAAM/B,GAAG,qBAAQ,KAAKN,QAAb,CAAT;;AACAsC,MAAAA,OAAO,CAACC,GAAR,CAAY,KAAZ,EAAkBjC,GAAlB;AACA,UAAIG,MAAM,GAAGH,GAAG,CAACG,MAAjB;AACA,UAAIC,KAAK,GAAGJ,GAAG,CAACI,KAAhB;AACA,UAAIH,GAAG,GAAGD,GAAG,CAACC,GAAd;AACA,UAAIC,IAAI,GAAGF,GAAG,CAACE,IAAf;AACA,UAAIgC,MAAM,GAAGL,SAAS,CAACM,OAAvB;AACA,UAAIC,MAAM,GAAGP,SAAS,CAACQ,OAAvB;;AACA,UAAIC,IAAI,GAAG,SAAPA,IAAO,CAAAC,SAAS,EAAI;AACtB,YAAIC,KAAK,GAAGD,SAAS,CAACJ,OAAtB;AACA,YAAIM,KAAK,GAAGF,SAAS,CAACF,OAAtB;AACA,YAAIK,IAAI,GAAGD,KAAK,GAAGL,MAAnB;AACA,YAAIO,IAAI,GAAGH,KAAK,GAAGN,MAAnB;AACA,YAAI7B,IAAI,GAAG,IAAIC,IAAJ,CAASR,KAAT,CAAX;AACA,YAAIS,IAAI,GAAG,IAAID,IAAJ,CAASR,KAAT,CAAX;AACA,YAAIU,IAAI,GAAG,IAAIF,IAAJ,CAASR,KAAT,CAAX;AACA,YAAIW,IAAI,GAAG,IAAIH,IAAJ,CAASR,KAAT,CAAX;AACA,YAAI8C,SAAS,GAAG,CAACzC,MAAD,IAAWE,IAAI,GAAG,CAACqC,IAAJ,GAAWnC,IAAI,GAAGmC,IAAH,GAAU,CAAxC,CAAhB;AACA,YAAIG,QAAQ,GAAG,CAACzC,KAAD,IAAUI,IAAI,GAAG,CAACmC,IAAJ,GAAWlC,IAAI,GAAGkC,IAAH,GAAU,CAAvC,CAAf;AACA3C,QAAAA,GAAG,CAACG,MAAJ,GAAayC,SAAS,GAAG,CAAZ,GAAgBA,SAAhB,GAA4B,CAAzC;AACA5C,QAAAA,GAAG,CAACI,KAAJ,GAAYyC,QAAQ,GAAG,CAAX,GAAeA,QAAf,GAA0B,CAAtC;AACA7C,QAAAA,GAAG,CAACE,IAAJ,GAAW,CAACA,IAAD,IAASM,IAAI,GAAGmC,IAAH,GAAU,CAAvB,CAAX;AACA3C,QAAAA,GAAG,CAACC,GAAJ,GAAU,CAACA,GAAD,IAAQI,IAAI,GAAGqC,IAAH,GAAU,CAAtB,CAAV;;AACA,QAAA,KAAI,CAACI,mBAAL,CAAyB9C,GAAzB;AACD,OAhBD;;AAiBA,UAAI+C,EAAE,GAAG,SAALA,EAAK,GAAM;AACb,QAAA,KAAI,CAACC,sBAAL;;AACAnC,QAAAA,QAAQ,CAACoC,mBAAT,CAA6B,WAA7B,EAA0CX,IAA1C;AACAzB,QAAAA,QAAQ,CAACoC,mBAAT,CAA6B,SAA7B,EAAwCF,EAAxC;AACD,OAJD;;AAKAlC,MAAAA,QAAQ,CAACqC,gBAAT,CAA0B,WAA1B,EAAuCZ,IAAvC;AACAzB,MAAAA,QAAQ,CAACqC,gBAAT,CAA0B,SAA1B,EAAqCH,EAArC;AACD,KA1FM;;AA2FP;;;;;AAKAI,IAAAA,mBAhGO,+BAgGcxB,CAhGd,EAgGiB;AAAA;;AACtB,UAAM3B,GAAG,qBAAQ,KAAKN,QAAb,CAAT;;AACA,UAAI0C,MAAM,GAAGT,CAAC,CAACU,OAAf;AACA,UAAIH,MAAM,GAAGP,CAAC,CAACQ,OAAf;AACA,UAAIiB,QAAQ,GAAGpD,GAAG,CAACC,GAAnB;AACA,UAAIoD,SAAS,GAAGrD,GAAG,CAACE,IAApB;;AAEA,UAAIoC,IAAI,GAAG,SAAPA,IAAO,CAAAC,SAAS,EAAI;AACtB;AACAA,QAAAA,SAAS,CAACT,eAAV;AACAS,QAAAA,SAAS,CAACR,cAAV;AAEA,YAAIS,KAAK,GAAGD,SAAS,CAACJ,OAAtB;AACA,YAAIM,KAAK,GAAGF,SAAS,CAACF,OAAtB;AACArC,QAAAA,GAAG,CAACC,GAAJ,GAAUwC,KAAK,GAAGL,MAAR,GAAiBgB,QAA3B;AACApD,QAAAA,GAAG,CAACE,IAAJ,GAAWsC,KAAK,GAAGN,MAAR,GAAiBmB,SAA5B;;AACA,QAAA,MAAI,CAACC,qBAAL,CAA2BtD,GAA3B;AACD,OAVD;;AAYA,UAAI+C,EAAE,GAAG,SAALA,EAAK,CAAAR,SAAS,EAAI;AACpB,QAAA,MAAI,CAACgB,wBAAL;;AACA1C,QAAAA,QAAQ,CAACoC,mBAAT,CAA6B,WAA7B,EAA0CX,IAA1C,EAAgD,IAAhD;AACAzB,QAAAA,QAAQ,CAACoC,mBAAT,CAA6B,SAA7B,EAAwCF,EAAxC,EAA4C,IAA5C;AACD,OAJD;;AAKAlC,MAAAA,QAAQ,CAACqC,gBAAT,CAA0B,WAA1B,EAAuCZ,IAAvC,EAA6C,IAA7C;AACAzB,MAAAA,QAAQ,CAACqC,gBAAT,CAA0B,SAA1B,EAAqCH,EAArC,EAAyC,IAAzC,EAzBsB,CA0BtB;;AACA,aAAO,IAAP;AACD,KA5HM;AA6HPS,IAAAA,eA7HO,2BA6HU7B,CA7HV,EA6Ha;AAClB,UAAI,KAAK8B,mBAAT,EAA8B;AAC5B,aAAKA,mBAAL;AACA,aAAKN,mBAAL,CAAyBxB,CAAzB,EAA4B,KAAK+B,OAAjC;AACD;AACF;AAlIM,GARI;AA4IbC,EAAAA,MA5Ia,kBA4ILC,CA5IK,EA4IF;AAAA;;AACT;AAAA;AAAA,iBAEa,KAAKlC,kBAFlB;AAAA,qBAGiB,KAAK8B;AAHtB;AAAA,eAIW;AAAE,iCAAyB,KAAKK;AAAhC;AAJX,QAOM,KAAKA,MAAL,IACAvE,MAAM,CAACiC,GAAP,CAAW,UAAAzB,KAAK,EAAI;AAClB,UAAMgE,UAAU,GAAG,MAAI,CAACjE,aAAL,CAAmBC,KAAnB,CAAnB;;AACA;AAAA,eAESA,KAFT;AAAA;AAAA,wBAGgBA;AAHhB;AAAA,iBAIWgE,UAJX;AAAA,iBAKU,oBALV;AAAA;AAAA,uBAMiB,MAAI,CAAClC,gBAAL,CAAsBmC,IAAtB,CAA2B,MAA3B,EAAiCjE,KAAjC;AANjB;AAAA;AASD,KAXD,CARN,EAqBK,KAAKkE,MAAL,CAAYC,OArBjB;AAwBD;AArKY,CAAf","sourcesContent":["import animationMixin from '@/mixins/animation.js'\r\n\r\n/**\r\n * #!zh: 上下左右 对应的 东南西北\r\n * #!en: top(north)、bottom(south)、left(west)、right(east)\r\n */\r\nconst directionKey = {\r\n  t: 'n',\r\n  b: 's',\r\n  l: 'w',\r\n  r: 'e'\r\n}\r\n\r\n// #!zh: 四个边角、两条中线上的点\r\nconst points = ['lt', 'rt', 'lb', 'rb', 'l', 'r', 't', 'b']\r\n\r\nexport default {\r\n  mixins: [animationMixin],\r\n  props: ['defaultPosition', 'active', 'handleMousedownProp', 'handleElementMoveProp', 'handlePointMoveProp', 'handleElementMouseUpProp', 'handlePointMouseUpProp', 'element'],\r\n  computed: {\r\n    position () {\r\n      return { ...this.defaultPosition }\r\n    }\r\n  },\r\n  methods: {\r\n    /**\r\n     * 通过方位计算样式，主要是 top、left、鼠标样式\r\n     */\r\n    getPointStyle (point, isWrapElement = true) {\r\n      \r\n      const pos = this.position\r\n      const top = pos.top // !#zh 减4是为了让元素能够处于 border 的中间\r\n      const left = pos.left\r\n      const height = pos.height\r\n      const width = pos.width\r\n      let hasT = /t/.test(point)\r\n      let hasB = /b/.test(point)\r\n      let hasL = /l/.test(point)\r\n      let hasR = /r/.test(point)\r\n      let newLeft = 0\r\n      let newTop = 0\r\n      let cans = document.getElementsByClassName('edit-mode')[0].clientHeight;\r\n      if(pos.top +pos.height> cans){\r\n        document.getElementsByClassName('edit-mode')[0].style.height=pos.top + pos.height + 'px'\r\n        document.getElementsByClassName('canvas-wrapper')[0].style.height = pos.top + pos.height + 'px'\r\n      }else if(pos.top + pos.height<= 566){\r\n        document.getElementsByClassName('edit-mode')[0].style.height = 566 +'px';\r\n      }\r\n      if (point.length === 2) {\r\n        newLeft = hasL ? 0 : width\r\n        newTop = hasT ? 0 : height\r\n      } else {\r\n        // !#zh 上下点，宽度固定在中间\r\n        if (hasT || hasB) {\r\n          newLeft = width / 2\r\n          newTop = hasT ? 0 : height\r\n        }\r\n        // !#zh 左右点，高度固定在中间\r\n        if (hasL || hasR) {\r\n          newLeft = hasL ? 0 : width\r\n          newTop = height / 2\r\n        }\r\n      }\r\n      const style = {\r\n        marginLeft: (hasL || hasR) ? '-3px' : 0,\r\n        marginTop: (hasT || hasB) ? '-3px' : 0,\r\n        left: `${newLeft + (isWrapElement ? 0 : left)}px`,\r\n        top: `${newTop + (isWrapElement ? 0 : top)}px`,\r\n        cursor: point.split('').reverse().map(m => directionKey[m]).join('') + '-resize'\r\n      }\r\n      return style\r\n    },\r\n    /**\r\n     * !#zh 主要目的是：阻止冒泡\r\n     */\r\n    handleWrapperClick (e) {\r\n      // e.stopPropagation()\r\n      // e.preventDefault()\r\n    },\r\n    mousedownForMark (point, downEvent) {\r\n      downEvent.stopPropagation()\r\n      downEvent.preventDefault() // Let's stop this event.\r\n      const pos = { ...this.position }\r\n      console.log('pos',pos)\r\n      let height = pos.height\r\n      let width = pos.width\r\n      let top = pos.top\r\n      let left = pos.left\r\n      let startX = downEvent.clientX\r\n      let startY = downEvent.clientY\r\n      let move = moveEvent => {\r\n        let currX = moveEvent.clientX\r\n        let currY = moveEvent.clientY\r\n        let disY = currY - startY\r\n        let disX = currX - startX\r\n        let hasT = /t/.test(point)\r\n        let hasB = /b/.test(point)\r\n        let hasL = /l/.test(point)\r\n        let hasR = /r/.test(point)\r\n        let newHeight = +height + (hasT ? -disY : hasB ? disY : 0)\r\n        let newWidth = +width + (hasL ? -disX : hasR ? disX : 0)\r\n        pos.height = newHeight > 0 ? newHeight : 0\r\n        pos.width = newWidth > 0 ? newWidth : 0\r\n        pos.left = +left + (hasL ? disX : 0)\r\n        pos.top = +top + (hasT ? disY : 0)\r\n        this.handlePointMoveProp(pos)\r\n      }\r\n      let up = () => {\r\n        this.handlePointMouseUpProp()\r\n        document.removeEventListener('mousemove', move)\r\n        document.removeEventListener('mouseup', up)\r\n      }\r\n      document.addEventListener('mousemove', move)\r\n      document.addEventListener('mouseup', up)\r\n    },\r\n    /**\r\n     * !#zh 给 当前选中元素 添加鼠标移动相关事件\r\n     *\r\n     * @param {mouseEvent} e\r\n     */\r\n    mousedownForElement (e) {\r\n      const pos = { ...this.position }\r\n      let startY = e.clientY\r\n      let startX = e.clientX\r\n      let startTop = pos.top\r\n      let startLeft = pos.left\r\n\r\n      let move = moveEvent => {\r\n        // !#zh 移动的时候，不需要向后代元素传递事件，只需要单纯的移动就OK\r\n        moveEvent.stopPropagation()\r\n        moveEvent.preventDefault()\r\n\r\n        let currX = moveEvent.clientX\r\n        let currY = moveEvent.clientY\r\n        pos.top = currY - startY + startTop\r\n        pos.left = currX - startX + startLeft\r\n        this.handleElementMoveProp(pos)\r\n      }\r\n\r\n      let up = moveEvent => {\r\n        this.handleElementMouseUpProp()\r\n        document.removeEventListener('mousemove', move, true)\r\n        document.removeEventListener('mouseup', up, true)\r\n      }\r\n      document.addEventListener('mousemove', move, true)\r\n      document.addEventListener('mouseup', up, true)\r\n      // TODO add comment\r\n      return true\r\n    },\r\n    handleMousedown (e) {\r\n      if (this.handleMousedownProp) {\r\n        this.handleMousedownProp()\r\n        this.mousedownForElement(e, this.element)\r\n      }\r\n    }\r\n  },\r\n  render (h) {\r\n    return (\r\n      <div\r\n        onClick={this.handleWrapperClick}\r\n        onMousedown={this.handleMousedown}\r\n        class={{ 'shape__wrapper-active': this.active }}\r\n      >\r\n        {\r\n          this.active &&\r\n          points.map(point => {\r\n            const pointStyle = this.getPointStyle(point)\r\n            return (\r\n              <div\r\n                key={point}\r\n                data-point={point}\r\n                style={pointStyle}\r\n                class=\"shape__scale-point\"\r\n                onMousedown={this.mousedownForMark.bind(this, point)}\r\n              ></div>\r\n            )\r\n          })\r\n        }\r\n        {this.$slots.default}\r\n      </div>\r\n    )\r\n  }\r\n}\r\n"]}]}